{{ define "main" }}
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-xxl-11 mx-auto">
        <div class="mb-5 pb-2">
          <h2 class="h3"><span class="text-primary pe-3 small">//</span>{{ .Title | title }}</h2>
          <p class="lead">{{ .Description | markdownify }}</p>
        </div>

        {{ $archiveSectionPage := site.GetPage "courses/archive" }}
        {{ $courseIndexPages := slice }}
        {{ range where (where .Site.RegularPages "Section" "courses") ".File.BaseFileName" "_index" }}
            {{ $isArchived := false }}
            {{ if $archiveSectionPage }}
                {{ if or (eq . $archiveSectionPage) (.IsDescendant $archiveSectionPage) }}
                    {{ $isArchived = true }}
                {{ end }}
            {{ end }}
            {{ if not $isArchived }}
                {{ $courseIndexPages = $courseIndexPages | append . }}
            {{ end }}
        {{ end }}
        
        {{/* Sort courses by title */}}
        {{ $sortedCourseIndexPages := sort $courseIndexPages ".Title" }}

        <div style="background: yellow; padding: 10px; margin: 10px 0; border: 2px solid red;">
          <h3>DEBUG INFO:</h3>
          <p><strong>Total courses found: {{ len $sortedCourseIndexPages }}</strong></p>
          <ul>
            {{ range $sortedCourseIndexPages }}
              <li>{{ .Title }} ({{ .RelPermalink }})</li>
            {{ end }}
          </ul>
        </div>

        {{ if gt (len $sortedCourseIndexPages) 0 }}
        <div class="courses align-items-start overflow-hidden">
          {{ range $sortedCourseIndexPages }}
            <div class="course-item mb-4">
              <div style="background: lightblue; padding: 5px; margin: 5px 0;">
                <small><strong>Rendering:</strong> {{ .Title }}</small>
              </div>
              {{ .Render "course-card" }}
            </div>
          {{ end }}
        </div>
        {{ else }}
        <p>There are currently no courses to display in this section.</p>
        {{ end }}
      </div>
    </div>
  </div>
</section>
{{ end }}